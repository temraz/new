!function(b){var l=function(a,c){this.options=c;this.$element=b(a);this.$container=b('<div id="ms-'+this.$element.attr("id")+'" class="ms-container"></div>');this.$selectableContainer=b('<div class="ms-selectable"></div>');this.$selectionContainer=b('<div class="ms-selection"></div>');this.$selectableUl=b('<ul class="ms-list"></ul>');this.$selectionUl=b('<ul class="ms-list"></ul>');this.scrollTo=0};l.prototype={constructor:l,init:function(){var a=this,c=this.$element;if(0==c.next(".ms-container").length){c.css({position:"absolute",
left:"-9999px"});c.attr("id",c.attr("id")?c.attr("id"):"ms-"+Math.ceil(1E3*Math.random()));var d=null,e=null,f=0;c.find("optgroup, option").each(function(){if(b(this).is("optgroup")){d="<span>"+b(this).attr("label")+"</span>";e="ms-"+c.attr("id")+"-optgroup-"+f;var r=b(this),j=b('<li class="ms-optgroup-container"></li>'),k=b('<li class="ms-optgroup-container"></li>'),g=b('<li class="ms-optgroup-label"><span></span></li>'),m=b('<li class="ms-optgroup-label"><span></span></li>');a.options.selectableOptgroup&&
(m.on("click",function(){var c=r.children(":not(:selected)").map(function(){return b(this).val()}).get();a.select(c)}),g.on("click",function(){var c=r.children(":selected").map(function(){return b(this).val()}).get();a.deselect(c)}));m.html(d);j.attr("id",e+"-selectable").append(b('<ul class="ms-optgroup"></ul>').append(m));a.$selectableUl.append(j);g.html(d);k.attr("id",e+"-selection").append(b('<ul class="ms-optgroup"></ul>').append(g));a.$selectionUl.append(k);f++}else{j="";for(k=0;k<this.attributes.length;k++)g=
this.attributes[k],a.isDomNode(g.name)&&(j+=g.name+'="'+g.value+'" ');j=b("<li "+j+"><span>"+b(this).text()+"</span></li>");k=j.clone();g=b(this).val();m=a.sanitize(g);j.data("ms-value",g).addClass("ms-elem-selectable").attr("id",m+"-selectable");k.data("ms-value",g).addClass("ms-elem-selection").attr("id",m+"-selection").hide();a.$selectionUl.find(".ms-optgroup-label").hide();if(b(this).prop("disabled")||c.prop("disabled"))this.selected?(k.prop("disabled",!0),k.addClass(a.options.disabledClass)):
(j.prop("disabled",!0),j.addClass(a.options.disabledClass));e?(a.$selectableUl.children("#"+e+"-selectable").find("ul").first().append(j),a.$selectionUl.children("#"+e+"-selection").find("ul").first().append(k)):(a.$selectableUl.append(j),a.$selectionUl.append(k))}});a.options.selectableHeader&&a.$selectableContainer.append(a.options.selectableHeader);a.$selectableContainer.append(a.$selectableUl);a.options.selectableFooter&&a.$selectableContainer.append(a.options.selectableFooter);a.options.selectionHeader&&
a.$selectionContainer.append(a.options.selectionHeader);a.$selectionContainer.append(a.$selectionUl);a.options.selectionFooter&&a.$selectionContainer.append(a.options.selectionFooter);a.$container.append(a.$selectableContainer);a.$container.append(a.$selectionContainer);c.after(a.$container);a.$selectableUl.on("mouseenter",".ms-elem-selectable",function(){b("li",a.$container).removeClass("ms-hover");b(this).addClass("ms-hover")}).on("mouseleave",function(){b("li",a.$container).removeClass("ms-hover")});
a.options.dblClick?(a.$selectableUl.on("dblclick",".ms-elem-selectable",function(){a.select(b(this).data("ms-value"))}),a.$selectionUl.on("dblclick",".ms-elem-selection",function(){a.deselect(b(this).data("ms-value"))})):(a.$selectableUl.on("click",".ms-elem-selectable",function(){a.select(b(this).data("ms-value"))}),a.$selectionUl.on("click",".ms-elem-selection",function(){a.deselect(b(this).data("ms-value"))}));a.$selectionUl.on("mouseenter",".ms-elem-selection",function(){b("li",a.$selectionUl).removeClass("ms-hover");
b(this).addClass("ms-hover")}).on("mouseleave",function(){b("li",a.$selectionUl).removeClass("ms-hover")});a.$selectableUl.on("focusin",function(){b(this).addClass("ms-focus");a.$selectionUl.focusout()}).on("focusout",function(){b(this).removeClass("ms-focus");b("li",a.$container).removeClass("ms-hover")});a.$selectionUl.on("focusin",function(){b(this).addClass("ms-focus")}).on("focusout",function(){b(this).removeClass("ms-focus");b("li",a.$container).removeClass("ms-hover")});c.on("focusin",function(){c.focusout();
a.$selectableUl.focusin()}).on("focusout",function(){a.$selectableUl.removeClass("ms-focus");a.$selectionUl.removeClass("ms-focus")});c.onKeyDown=function(b,c){var d=a.$container.find("."+c).find(".ms-list"),g=d.find("li:visible:not(.ms-optgroup-label, .ms-optgroup-container)"),e=g.length,f=d.find("li.ms-hover"),h=0<f.length?g.index(f):-1,l=d.innerHeight(),n=g.first().outerHeight(!0),l=Math.floor(l/n);if(32==b.keyCode)0<f.length&&("ms-selectable"==c?a.select(f.data("ms-value")):a.deselect(f.data("ms-value")),
g.removeClass("ms-hover"),a.scrollTo=0,d.scrollTop(a.scrollTo));else if(40==b.keyCode){if(0<g.length){var h=h+1,p=e!=h?g.eq(h):g.first(),f=d.position().top,q=p.position().top;g.removeClass("ms-hover");p.addClass("ms-hover");e==h?a.scrollTo=0:q>=f+l*n&&(a.scrollTo+=n);d.scrollTop(a.scrollTo)}}else if(38==b.keyCode)0<g.length&&(h=Math.max(h-1,-1),p=g.eq(h),f=d.position().top,q=p.position().top,g.removeClass("ms-hover"),p.addClass("ms-hover"),q<=f?a.scrollTo-=n:0>h&&(a.scrollTo=(e-l)*n),d.scrollTop(a.scrollTo));
else if(37==b.keyCode||39==b.keyCode)a.$selectableUl.hasClass("ms-focus")?(a.$selectableUl.focusout(),a.$selectionUl.focusin()):(a.$selectableUl.focusin(),a.$selectionUl.focusout())};c.on("keydown",function(b){if(c.is(":focus")){var d=a.$selectableUl.hasClass("ms-focus")?"ms-selectable":"ms-selection";c.onKeyDown(b,d)}})}var h=c.find("option:selected").map(function(){return b(this).val()}).get();a.select(h,"init");"function"==typeof a.options.afterInit&&a.options.afterInit.call(this,this.$container)},
refresh:function(){b("#ms-"+this.$element.attr("id")).remove();this.init(this.options)},select:function(a,c){"string"==typeof a&&(a=[a]);var d=this,e=this.$element,f=b.map(a,function(a){return d.sanitize(a)}),h=this.$selectableUl.find("#"+f.join("-selectable, #")+"-selectable").filter(":not(."+d.options.disabledClass+")"),f=this.$selectionUl.find("#"+f.join("-selection, #")+"-selection"),l=e.find("option").filter(function(){return-1<b.inArray(this.value,a)});0<h.length&&(h.addClass("ms-selected").hide(),
f.addClass("ms-selected").show(),l.prop("selected",!0),h=d.$selectableUl.children(".ms-optgroup-container"),0<h.length&&(h.each(function(){var a=b(this).find(".ms-elem-selectable");a.length==a.filter(".ms-selected").length&&b(this).find(".ms-optgroup-label").hide()}),d.$selectionUl.children(".ms-optgroup-container").each(function(){0<b(this).find(".ms-elem-selection").filter(".ms-selected").length&&b(this).find(".ms-optgroup-label").show()})),"init"!=c&&(d.$selectionUl.focusout(),d.$selectableUl.focusin(),
e.trigger("change"),"function"==typeof d.options.afterSelect&&d.options.afterSelect.call(this,a)))},deselect:function(a){"string"==typeof a&&(a=[a]);var c=this,d=this.$element,e=b.map(a,function(a){return c.sanitize(a)}),f=this.$selectableUl.find("#"+e.join("-selectable, #")+"-selectable"),e=this.$selectionUl.find("#"+e.join("-selection, #")+"-selection").filter(".ms-selected"),h=d.find("option").filter(function(){return-1<b.inArray(this.value,a)});0<e.length&&(f.removeClass("ms-selected").show(),
e.removeClass("ms-selected").hide(),h.prop("selected",!1),f=c.$selectableUl.children(".ms-optgroup-container"),0<f.length&&(f.each(function(){0<b(this).find(".ms-elem-selectable").filter(":not(.ms-selected)").length&&b(this).find(".ms-optgroup-label").show()}),c.$selectionUl.children(".ms-optgroup-container").each(function(){0==b(this).find(".ms-elem-selection").filter(".ms-selected").length&&b(this).find(".ms-optgroup-label").hide()})),this.$selectableUl.focusout(),this.$selectionUl.focusin(),d.trigger("change"),
"function"==typeof c.options.afterDeselect&&c.options.afterDeselect.call(this,a))},select_all:function(){var a=this.$element,c=a.val();a.find("option").prop("selected",!0);this.$selectableUl.find(".ms-elem-selectable").addClass("ms-selected").hide();this.$selectionUl.find(".ms-optgroup-label").show();this.$selectableUl.find(".ms-optgroup-label").hide();this.$selectionUl.find(".ms-elem-selection").addClass("ms-selected").show();this.$selectionUl.focusin();this.$selectableUl.focusout();a.trigger("change");
"function"==typeof this.options.afterSelect&&(a=b.grep(a.val(),function(a){return 0>b.inArray(a,c)}),this.options.afterSelect.call(this,a))},deselect_all:function(){var a=this.$element,b=a.val();a.find("option").prop("selected",!1);this.$selectableUl.find(".ms-elem-selectable").removeClass("ms-selected").show();this.$selectionUl.find(".ms-optgroup-label").hide();this.$selectableUl.find(".ms-optgroup-label").show();this.$selectionUl.find(".ms-elem-selection").removeClass("ms-selected").hide();this.$selectableUl.focusin();
this.$selectionUl.focusout();a.trigger("change");"function"==typeof this.options.afterDeselect&&this.options.afterDeselect.call(this,b)},isDomNode:function(a){return a&&"object"===typeof a&&"number"===typeof a.nodeType&&"string"===typeof a.nodeName},sanitize:function(a){return a.replace(/[^A-Za-z0-9]*/gi,"_")}};b.fn.multiSelect=function(){var a=arguments[0],c=arguments;return this.each(function(){var d=b(this),e=d.data("multiselect"),f=b.extend({},b.fn.multiSelect.defaults,d.data(),"object"==typeof a&&
a);e||d.data("multiselect",e=new l(this,f));if("string"==typeof a)e[a](c[1]);else e.init()})};b.fn.multiSelect.defaults={selectableOptgroup:!1,disabledClass:"disabled",dblClick:!1};b.fn.multiSelect.Constructor=l}(window.jQuery);